---
title: "Rmd Introduction - Part 2"
author: "oevkaya"
date: "`r Sys.Date()`"
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
    toc: true
---

## Modul 1- Part 2:

Bu bolumde 

- bazı kullanıslı notlar
- word sablonu olusturma ve
- regresyona dair birkaç ornek görüyor olacağız. 

---

## Insert Citations (Kaynakca)

-   Create citations from a bibliography file, a Zotero library, or from DOI references, by adding the following details on the YAML header
  - bibliography: references.bib 
  - link-citations: TRUE

-   If you are using Zotero, your main library will automatically be available.

-   Add citations by DOI by searching "from DOI" in the Insert Citation dialog.

- Within your document, cite sources using the citation key from your .bib file by writing [@cite] or @cite in the text. 

- If you are using the Visual Editor, by clicking the @ symbol in the toolbar or by clicking `Insert > Citation`

--- 

## Tips and Notes about Rmd 

- R code of the form {{ code }} is translated to an inline R expression in R Markdown. Please note that {{ code }} must be on its own line.

- Any text between /* and */ will be ignored (i.e., they are treated as true comments).

- The function `knitr::purl()` extracts R code chunks from a **knitr** document and save the code to an R script. If you do not want certain code chunks to be extracted,
you can set the chunk option `purl = FALSE`. 

- If you want to retain all the text, you may use the argument documentation = 2 (Default is documentation = 0)

---

- When you want to break a page, you can insert the command \newpage in the document. It is a LaTeX command, but the rmarkdown package is able to recognize it for both LaTeX output formats and a few non-LaTeX output formats including word 
 
- You can use inline R code (see Section 3.1) anywhere in an Rmd document, including the YAML metadata section. This means some YAML metadata can be dynamically generated with inline R code

- You can also generate titles or any YAML fields dynamically from parameters in parameterized reports

- When an Rmd document is compiled, all of its metadata in the YAML section will be stored in the list object rmarkdown::metadata. For example, rmarkdown::metadata$title gives you the title of the document. You can use this metadata object in your R code, so that you do not need to hard-code information that has been provided in the YAML metadata

---

- Most output formats support an option number_sections, which can be used to enable numbering sections if set to true (ie. using number_sections: true in the YAML header)

- If you want a certain section to be unnumbered when the option number_sections is true, you may add {-} after the section heading, e.g., using # This section is unnumbered {-}

- Equivalently, you may also use {.unnumbered}. You can also add other attributes to the heading, e.g., {.unnumbered #section-id}. 

- Please see https://pandoc.org/MANUAL.html#extension-header_attributes for more information.

- To cite an R package, you can use the function citation() from base R. If you want to generate a citation entry for BibTeX, you can pass the returned object of

```{r}
# toBibtex(citation("Rmarkdown"))
```


---

- If you are interested in using Cross-referencing in your Rmd file, not directly possible with Rmarkdown package, instead you need bookdown as an extra to consider the output options of html_document2, pdf_document2, and word_document2, etc. in the YAML output field.

- Figures without a caption will be included directly as images and will therefore not be a numbered figure.

- A labeled code chunk: This provides the identifier for referencing the figure generated by the chunk.

- If you want the date on which the Rmd document is compiled to be reflected in the output report, you can add an inline R expression to the date field in YAML, and use the Sys.Date() or Sys.time() function to obtain the current date

- As a final note, you may also want to include some explanatory text along with the date. You can add any text such as “Last compiled on” before the R code as follows:
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"

---

- We can add multiple authors to an R Markdown document within the YAML frontmatter in a number of ways; (i)we simply want to list them on the same line, we can provide a single string to the document, or (ii) Alternatively, if we wish each entry to be on its own line, we can provide a list of entries to the YAML field. This can be useful if you wish to include further information about each author such as an email address or institution

- Certain R Markdown templates will allow you to specify additional parameters directly within the YAML. For example, the Distill output format allows url, affiliation, and affiliation_url to be specified.

- We can use bookdown (Xie 2024a) output formats to add figure numbers to their captions, 

```{r}
# such as using the `output: bookdown::html_document2`
# and considering the input argument 'fig.cap = "An amazing plot"' 
# in your code chunk 
```


- Some characters have special meanings in the Markdown syntax. You need to escape the underscores if you want verbatim underscores instead of italic text. The way to escape a special character is to add a backslash before it, e.g., I do not want \_italic text\_ here. Similarly, if # does not indicate a section heading, you may write \# This is not a heading

---

- It is useful to comment out text in the source document, which will not be displayed in the final output document. For this purpose, we can use the HTML syntax <!-- your comment -->. The comments will not be displayed in any output format.

- Comments can span either a single line or multiple lines. This may be useful for you to write draft content.

- If you do not want certain section headings to be included in the table of contents, you can add two classes to the heading: unlisted and unnumbered
Code: # Section heading {.unlisted .unnumbered}

- There is a simple method of extracting all code chunks in a document and putting them together in a single code chunk using the 

```{r}
# chunk option ref.label and the function knitr::all_labels()
# {r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```


---

## Formatting text

The Markdown syntax has no built-in method for changing text colors. We can use HTML and LaTeX syntax to change the formatting of words:

- For HTML, we can wrap the text in the <span> tag and set color with CSS, e.g., <span style="color: red;">text</span>.

- For PDF, we can use the LaTeX command \textcolor{}{}. This requires the LaTeX package xcolor, which is included in Pandoc’s default LaTeX template.

- We can write a custom R function to insert the correct syntax depending on the output format using the is_latex_output() and is_html_output() functions in knitr

- Using a Pandoc Lua filter can be another option but that is a bit for advanced R users in general 

---

- Markdown will also ignore spaces used for indentation by default. However, we may want to keep the indentation in certain cases, e.g., in verses and addresses. 

- In these situations, we can use line blocks by starting the line with a vertical bar (|). The line breaks and any leading spaces will be preserved in the output.

| When dollars appear it's a sign
|   that your code does not quite align  

- Sometimes the text output printed from R code may be too wide. If the output document has a fixed page width (e.g., PDF documents), the text output may exceed the page margins. The R global option width can be used to control the width of printed text output from some R functions, and you may try a smaller value if the default is too large. This option typically indicates a rough number of characters per line

- Not all R functions respect the width option. If this option does not work, your only choice may be to wrap the long lines of text.

--- 

- Typically we write code chunks and inline expressions that we want to be parsed and evaluated by knitr. However, if you are trying to write a tutorial on using knitr, you may need to generate a verbatim code chunk or inline expression that is not parsed by knitr. 

- The verbatim engine can take any R Markdown content and output it as-is in the resulting document. By using more backticks on the outer fences than the backticks in the inner content, a whole code chunk including the chunk header can be included in a verbatim chunk

# ````{verbatim}
# ```{r, eval=TRUE}
# 1 + 1
# ```
# ````

- You can add line numbers to either source code blocks, via the chunk option attr.source = ".numberLines", or text output blocks, via attr.output = ".numberLines"

For further details, look at https://bookdown.org/yihui/rmarkdown-cookbook/, especially Sections 14-16-17 can be useful for your templates!

---

## Introduction to the `officer` Package

- **Purpose:** Facilitates the creation and manipulation of Microsoft Word (`.docx`) and PowerPoint (`.pptx`) documents directly from R.
- **Key Features:**
  - Add text, images, tables, and plots to documents.
  - Customize document styles and layouts.
  - Automate report generation.

--- 

### Creating a new word doc in R 

```{r}
# Load the officer package
library(officer)

# Create a new Word document
doc <- read_docx()
# Add a title
doc <- body_add_par(doc, "Introduction to the officer Package", style = "heading 1")

# Add a paragraph of text
doc <- body_add_par(doc, "The officer package allows R users to generate Word documents programmatically.", style = "Normal")

# Save the document
print(doc, target = "officer_intro.docx")

```


---

### Adding a Table 

```{r}
# Sample data frame
df <- data.frame(
  Name = c("Alice", "Bob", "Charlie"),
  Score = c(85, 92, 78)
)

# Add a table to the document
doc <- body_add_table(doc, value = df, style = "table_template")

# Save the document
print(doc, target = "officer_intro.docx")
```

--- 

### Overview 

- There are similar functions to work on ppt files 

- The officer package provides a powerful interface to create and manipulate Word and PowerPoint documents directly from R.

- It enables automation of report generation, ensuring reproducibility and efficiency.

- By integrating officer into your R workflow, you can produce dynamic and customizable documents tailored to your needs.

--- 

## Working with Word Templates 

To generate a Word document from R Markdown, you can use the output format word_document. If you want to include cross-references in the document, you may consider the output format `bookdown::word_document2`

Possible questions to answer;

1. How can I apply a custom Word template to the document?

2. How can I incorporate changes made in Word in the original R Markdown document?

3. How can I style individual document elements?

---

### Custom Word templates

- You can apply the styles defined in a Word template document to new Word documents generated from R Markdown. 

- Such a template document is also called a “style reference document.” The key is that you have to create this template document from Pandoc first, and change the style definitions in it later. 

- Then pass the path of this template to the reference_docx option of word_document

# ````{verbatim}
# ---
# output:
#   word_document:
#     reference_docx: "template.docx"
# ---
# ````

- As we just mentioned, the document template.docx has to be generated from Pandoc. You can create this template from an arbitrary R Markdown document with the word_document output format (the actual content of this document does not matter, but it should contain the type of elements of which you want to style)

- Then open the .docx file, and edit the styles based on your needs

---

- Then, you can open the “Styles” window from the “HOME” tab in Word. 

- When you move the cursor to a specific element in the document, an item in the styles list will be highlighted. 

- If you want to modify the style of any type of element, you can click the drop-down menu on the highlighted item, and you will see a dialog box

- After you finish modifying the styles, you can save the document (with a filename that will not be accidentally overwritten), and use it as the template for future Word documents

- When Pandoc renders a new Word document with a reference document (template), it will read the styles in the template and apply them to the new document.

- Sometimes it may not be straightforward to find the style name for an element. There may be multiple styles applied to the same element, and you will only see one of them highlighted in the list of styles. It may require some guesswork and online searching to figure out the actual style that you want to modify.

---

### Style individual elements

- Due to the simplicity of Markdown, you can apply some global styles to the Word document, but it is not straightforward to style individual elements, such as changing the color of a word, or centering a paragraph.

- Continuing his effort to make it easier to work with Office documents in R, David Gohel started to develop the officedown package (Gohel and Ross 2024) in 2018, which aims to bring some officer (Gohel and Moog 2024) features into R Markdown.

- There is an output format rdocx_document in the officedown package, which is based on rmarkdown::word_document by default, and has several other features such as styling tables and plots.

- The officedown package allows you to style specific Word elements via the officer package. For example, you can create a style via the function officer::fp_text(), and apply the style to a piece of text via ftext() an inline R expression

--- 

### Things to do 

- Insert page breaks.

- Put content in a multi-column layout.

- Change paragraph settings.

- Insert a table of contents.

- Change the orientation of a section (landscape or portrait).

To learn more about officedown, please check out its documentation at https://davidgohel.github.io/officedown/.

---

### Officedown Package

- officedown is bringing some officer features into R markdown documents.

- Compatibility with the functions of the package ‘officer’ for the production of “runs” and “blocks” of content (text formatting, landscape mode, tables of contents, etc.).

- Ability to use the table styles and list styles defined in the “reference_docx” which serves as a template for the pandoc document.

-The replacement of captions (tables, figures and standard identifiers) by captions containing a Word bookmark that can be used for cross-referencing. 

- Also the replacement of cross-references by cross-references using fields calculated by Word. The syntax conforms to the bookdown cross-reference definition.

---

- Full support for flextable output, including with outputs containing images and links.

- Easy to copy and paste the content into another document without losing the reference numbers. Captions are also auto-numbered by Word.

- The package enable knitting flextable outputs with images or plots in cells without using officer. Insertion of images in flextable is not supported with rmarkdown::word_document but is possible by using officedown::rdocx_document.

---

### Automated formatting

The package will automatically perform a set of formatting tasks on the resulting document.

- Use a Word table template to format all the data.frame that are printed in the document.

- Use two Word list templates (for unordered lists and for ordered lists) to format the set of ordered and ordered lists defined in the R Markdown document.

- Transforming the cross-references and captions defined in the R Markdown document as calculated by Word. It is then easy to copy and paste the content into another document without losing the reference numbers. Captions are also auto-numbered by Word.

The parameters of these transformations are defined in the officedown::rdocx_document function. They can be defined in the YAML header of the R Markdown document.

---

### Tables

The parameter tables is a list that can contain few items to style tables and table captions.

- style: the Word stylename to use for tables.

- layout: ‘autofit’ or ‘fixed’ algorithm.

- width: value of the preferred width of the table in percent (base 1).

- caption; caption options, i.e.:
    - style: Word stylename to use for table captions.
    - pre: prefix for numbering chunk (default to “Table”).
    - sep: suffix for numbering chunk (default to “:”).

- conditional: a list of named logical values:
    - first_row and last_row: apply or remove formatting from the first or last row in the table
    - first_column and last_column: apply or remove formatting from the first or last column in the table
    - no_hband and no_vband: don’t display odd and even rows or columns with alternating shading for ease of reading.
    
---

### Plots

The parameter plots is a list that can contain few items to style plots and figure captions:

- style: the Word stylename to use for plots.

- align: alignment of figures in the output document (possible values are ‘left’, ‘right’ and ‘center’).

- caption; caption options, i.e.:
    -style: Word stylename to use for figure captions.
    -pre: prefix for numbering chunk (default to “Figure”).
    -sep: suffix for numbering chunk (default to “:”).

--- 

### Lists

- The parameter lists is a list that can contain two named items ol.style and ul.style, values are the stylenames to be used to replace the style of ordered and unordered lists created by pandoc. If NULL, no replacement is made.

- The default values are the following values:

```{r}
# list(ol.style = NULL, ul.style = NULL)
```

---

### Page dimensions

- You can change the default page dimensions of your document by setting the values for page_size and page_margins

###  Default settings

- The package is using global settings, used for customization of tables, lists, plots captions and page dimensions.

- There is a mechanism to overwrite the defaults with the specified values. This makes it possible not to fill in all the arguments. Thus, a header like the following one is valid

---

### Caption label for figures and tables

- Use knitr chunk options fig.cap or tab.cap to specify the label of the Word caption associated with a table or a figure. 

- If a table, caption will be added before the table, if a graphic, caption will be added after the graphic (unless you set chunk option fig.topcaption=TRUE).

Examples; 

Figure

```{r fig.cap="economics plot", fig.id = "tsplot", fig.cap.style = "Image Caption"}
# ggplot(economics, aes(date, unemploy / pop)) + 
#   geom_line() + 
#  theme_minimal()
```

Table

```{r tab.cap="economics table", tab.id = "mytab", tab.cap.style = "Table Caption"}
# head(economics)
```

---

- Function knitr::opts_chunk$set() or common knitr chunk options can be used to set the values. Captions for tables and figures can be configured and officedown has special instructions to manage their values and formats

- We have chosen default values for the options that are common in terms of usage but these values correspond to the English language

- If you are writing in another language like Turkish, you probably want to change these values to match your language

---

### Cross-references

- Cross-referencing is particularly interesting when using {bookdown}. 

- Bookdown references and captions are not always satisfying some organizations requirements that impose usage of computed numbered captions and references to them for Word documents. 

- ‘officedown’ bring this feature: caption are autonumbered and a bookmark is set on the chunk containing the number; cross-references are Word references hyperlinked to the captions they are related to

- The functionality will allow the editing of Word documents produced with respect of different references or numbered captions. 

- This is particulary useful when the document is modified in its structure (chapters moved, graphics added manually) or integrated into another Word document.

- To refer to simple document id, use syntax \@ref(an_id) such as \@ref(fig:tsplot) or \@ref(tab:mytab)

Note: If you want a different cross-reference, then you will have to manually recompose the caption. 

https://ardata-fr.github.io/officeverse/officedown-for-word.html#custom-cross-reference

###  Paragraphs, tables and TOC

- Paragraphs defined with the fpar() function as well as many other objects from the officer package can be used within a R Markdown document.

- Formatted Paragraphs: Objects produced by function fpar can be integrated into the final document:

- Add Word captions: Objects produced by function block_caption can be added as in the following example.

- Tables: For complex formatting, the ‘flextable’ package is preferable.

- A TOC (Table of Contents) is a Word computed field, table of contents is built by Word. The TOC field will collect entries using heading styles or another specified style.

- You can list and organize the figures or tables in a Word document by creating a table of figures, much like a table of contents.

- Emdeb Word content: You can pour the content of a docx file in the resulting docx generated by the main R Markdown document.

- Insert sections: To format your content in a section, you can use the section tags or define the section with the block_section function, which takes an object returned by the prop_section function. It is prop_section() that allows you to define the properties of your section.

---

### Charts with mschart

- Package mschart lets R users to create Microsoft Office charts from data, and then add title, legends, and annotations to the chart object.

- The graph produced is a Microsoft graph, which means that it can be edited in your Microsoft software and that the underlying data are available.

- The package will not allow you to make the same charts as with ggplot2. 

- It allows only a subset of the charts possible with ‘Office Chart’. 

- The package is often used to industrialize graphs that are then consumed and annotated by non-R users.

---

### How to create?

Names of high level functions are all prefixed with ms_. The following charts are the only available from all possible MS charts:

```{r}
# barcharts: ms_barchart()
# line charts: ms_linechart()
# scatter plots: ms_scatterchart()
# area charts: ms_areachart()
```


They all are producing a chart that can be quickly previewed with command:

```{r}
# print(the_chart, preview = TRUE)
```



- After the creation of the object, it can be customized
    - by using options specific to the chart (with chart_settings()),
    - by changing the options related to the axes (with chart_ax_x() and chart_ax_y()),
    - by changing the options related to the labels (with chart_data_labels()),
    - by changing the colors, line widths, … 
    - by changing the general theme with function chart_theme(),
    - by changing the title labels with function chart_labels()

---

### Some Examples with ms_chart()

```{r, eval=FALSE}
library(officedown)
library(mschart)
library(tidyverse)


mtcars$cyl <- as.factor(mtcars$cyl)
# Create bar chart
the_chart <- ms_barchart(data = mtcars, x = "cyl", y = "mpg", group = "cyl")
print(the_chart, preview = TRUE)

```


---

### Regression summary report example 

Kullanıslı olabilecek paketler 

- broom
  - tidy() summarizes information about model components
  - glance() reports information about the entire model
  - augment() adds informations about observations to a dataset

- performance
  - check_model()
  - model_performance()
  - compare_performance()
  - test_performance()

- report 
  - report()

---

### Kullanılan Kaynaklar

- https://rmarkdown.rstudio.com/articles_docx.html

- https://bookdown.org/yihui/rmarkdown-cookbook/word-template.html

- https://ardata-fr.github.io/officeverse/index.html

- https://broom.tidymodels.org/

- https://easystats.github.io/performance/index.html

- https://easystats.github.io/report/



